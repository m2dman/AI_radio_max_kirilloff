<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Музыкальный анализатор Татарстана</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        body {
            background: linear-gradient(135deg, #f8fdff 0%, #e6f7ff 100%);
            color: #333;
            min-height: 100vh;
            padding: 20px;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
        }
        
        header {
            text-align: center;
            padding: 30px 0;
            border-bottom: 2px solid rgba(0, 123, 255, 0.1);
            margin-bottom: 40px;
        }
        
        h1 {
            font-size: 2.8rem;
            margin-bottom: 10px;
            background: linear-gradient(90deg, #0066cc, #00b3ff);
            -webkit-background-clip: text;
            background-clip: text;
            color: transparent;
        }
        
        .subtitle {
            font-size: 1.2rem;
            color: #666;
            max-width: 800px;
            margin: 0 auto;
            line-height: 1.6;
        }
        
        .main-content {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 30px;
            margin-bottom: 40px;
        }
        
        @media (max-width: 900px) {
            .main-content {
                grid-template-columns: 1fr;
            }
        }
        
        .card {
            background: white;
            border-radius: 20px;
            padding: 30px;
            box-shadow: 0 8px 25px rgba(0, 102, 204, 0.08);
            border: 1px solid rgba(0, 123, 255, 0.15);
            transition: transform 0.3s ease, box-shadow 0.3s ease;
        }
        
        .card:hover {
            transform: translateY(-5px);
            box-shadow: 0 12px 30px rgba(0, 102, 204, 0.12);
        }
        
        .card h2 {
            font-size: 1.8rem;
            margin-bottom: 20px;
            color: #0066cc;
            display: flex;
            align-items: center;
            gap: 10px;
            padding-bottom: 10px;
            border-bottom: 2px solid rgba(0, 102, 204, 0.1);
        }
        
        .card h2 i {
            color: #00b3ff;
        }
        
        .recorder-section {
            display: flex;
            flex-direction: column;
            gap: 20px;
        }
        
        .recorder-controls {
            display: flex;
            justify-content: center;
            gap: 20px;
            margin-top: 10px;
        }
        
        .btn {
            padding: 15px 30px;
            border: none;
            border-radius: 50px;
            font-size: 1.1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 10px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
        }
        
        .btn-record {
            background: linear-gradient(90deg, #ff3b3b, #ff6666);
            color: white;
        }
        
        .btn-stop {
            background: linear-gradient(90deg, #00a86b, #00cc88);
            color: white;
        }
        
        .btn-analyze {
            background: linear-gradient(90deg, #0066cc, #00b3ff);
            color: white;
            width: 100%;
            justify-content: center;
            margin-top: 10px;
        }
        
        .btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 6px 15px rgba(0, 0, 0, 0.15);
        }
        
        .btn:active {
            transform: translateY(1px);
        }
        
        .btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
        }
        
        .audio-visualizer {
            width: 100%;
            height: 150px;
            background: linear-gradient(180deg, #f0f9ff 0%, #e6f7ff 100%);
            border-radius: 15px;
            margin: 20px 0;
            position: relative;
            overflow: hidden;
            border: 1px solid rgba(0, 123, 255, 0.2);
        }
        
        .visualizer-canvas {
            width: 100%;
            height: 100%;
        }
        
        .recording-status {
            text-align: center;
            padding: 15px;
            border-radius: 12px;
            margin-top: 20px;
            font-weight: 600;
            display: none;
            border: 1px solid;
        }
        
        .recording-active {
            background: rgba(255, 59, 59, 0.08);
            border-color: #ff3b3b;
            color: #cc0000;
            display: block;
        }
        
        .recording-stopped {
            background: rgba(0, 168, 107, 0.08);
            border-color: #00a86b;
            color: #006644;
            display: block;
        }
        
        .audio-player {
            width: 100%;
            margin-top: 20px;
            background: #f8fdff;
            border-radius: 12px;
            padding: 15px;
            border: 1px solid rgba(0, 123, 255, 0.2);
        }
        
        .audio-player audio {
            width: 100%;
            border-radius: 8px;
        }
        
        .analysis-results {
            display: none;
            margin-top: 20px;
        }
        
        .results-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 15px;
            margin-top: 20px;
        }
        
        .result-item {
            background: linear-gradient(135deg, #f0f9ff 0%, #e6f7ff 100%);
            padding: 18px;
            border-radius: 12px;
            border-left: 4px solid #0066cc;
            transition: transform 0.2s ease;
        }
        
        .result-item:hover {
            transform: translateY(-3px);
        }
        
        .result-label {
            font-size: 0.9rem;
            color: #666;
            margin-bottom: 8px;
            font-weight: 500;
        }
        
        .result-value {
            font-size: 1.6rem;
            font-weight: 700;
            color: #0066cc;
        }
        
        .radio-recommendations {
            margin-top: 40px;
        }
        
        .stations-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }
        
        .station-card {
            background: white;
            border-radius: 15px;
            padding: 22px;
            transition: all 0.3s ease;
            border: 1px solid rgba(0, 123, 255, 0.15);
            box-shadow: 0 5px 15px rgba(0, 102, 204, 0.05);
        }
        
        .station-card:hover {
            transform: translateY(-5px);
            border-color: #00b3ff;
            box-shadow: 0 10px 25px rgba(0, 102, 204, 0.12);
        }
        
        .station-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }
        
        .station-name {
            font-size: 1.3rem;
            font-weight: 700;
            color: #0066cc;
        }
        
        .station-city {
            background: linear-gradient(90deg, #e6f7ff, #cceeff);
            color: #0066cc;
            padding: 6px 12px;
            border-radius: 20px;
            font-size: 0.85rem;
            font-weight: 600;
            border: 1px solid rgba(0, 102, 204, 0.2);
        }
        
        .station-genre {
            color: #00b3ff;
            margin-bottom: 10px;
            font-size: 0.95rem;
            font-weight: 500;
        }
        
        .station-frequency {
            color: #666;
            font-size: 0.9rem;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .station-frequency i {
            color: #0066cc;
        }
        
        .station-match {
            background: linear-gradient(90deg, #e6f7ff, #cceeff);
            padding: 8px 12px;
            border-radius: 8px;
            margin-bottom: 15px;
            font-size: 0.9rem;
            color: #0066cc;
            border: 1px solid rgba(0, 102, 204, 0.2);
        }
        
        .station-match strong {
            font-size: 1.1rem;
        }
        
        .listen-btn {
            background: linear-gradient(90deg, #0066cc, #00b3ff);
            color: white;
            border: none;
            padding: 10px 18px;
            border-radius: 25px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 0.95rem;
            display: flex;
            align-items: center;
            gap: 8px;
            margin-top: 10px;
            width: 100%;
            justify-content: center;
            font-weight: 600;
            box-shadow: 0 4px 10px rgba(0, 102, 204, 0.2);
        }
        
        .listen-btn:hover {
            background: linear-gradient(90deg, #0055aa, #0099dd);
            transform: translateY(-2px);
            box-shadow: 0 6px 15px rgba(0, 102, 204, 0.25);
        }
        
        .chart-container {
            margin-top: 30px;
            height: 300px;
            background: white;
            border-radius: 15px;
            padding: 20px;
            border: 1px solid rgba(0, 123, 255, 0.15);
        }
        
        .loading {
            display: none;
            text-align: center;
            padding: 30px;
            background: white;
            border-radius: 15px;
            border: 1px solid rgba(0, 123, 255, 0.15);
        }
        
        .spinner {
            border: 5px solid rgba(0, 102, 204, 0.1);
            border-top: 5px solid #0066cc;
            border-radius: 50%;
            width: 50px;
            height: 50px;
            animation: spin 1s linear infinite;
            margin: 0 auto 15px;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        .pulse {
            animation: pulse 1.5s infinite;
        }
        
        @keyframes pulse {
            0% { opacity: 0.6; }
            50% { opacity: 1; }
            100% { opacity: 0.6; }
        }
        
        footer {
            text-align: center;
            padding: 30px 0;
            margin-top: 40px;
            border-top: 2px solid rgba(0, 123, 255, 0.1);
            color: #666;
            font-size: 0.9rem;
        }
        
        .logo {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 15px;
            margin-bottom: 10px;
        }
        
        .logo-icon {
            background: linear-gradient(90deg, #0066cc, #00b3ff);
            width: 40px;
            height: 40px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 1.2rem;
        }
        
        /* Стилизация полосы прокрутки */
        ::-webkit-scrollbar {
            width: 10px;
        }
        
        ::-webkit-scrollbar-track {
            background: #f1f9ff;
            border-radius: 5px;
        }
        
        ::-webkit-scrollbar-thumb {
            background: linear-gradient(180deg, #0066cc, #00b3ff);
            border-radius: 5px;
        }
        
        ::-webkit-scrollbar-thumb:hover {
            background: linear-gradient(180deg, #0055aa, #0099dd);
        }
        
        /* Стили для плавающих элементов */
        .floating-elements {
            position: fixed;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: -1;
            top: 0;
            left: 0;
        }
        
        .floating-element {
            position: absolute;
            background: rgba(0, 102, 204, 0.05);
            border-radius: 50%;
        }
        
        .floating-element:nth-child(1) {
            width: 150px;
            height: 150px;
            top: 10%;
            left: 5%;
            background: rgba(0, 179, 255, 0.05);
        }
        
        .floating-element:nth-child(2) {
            width: 200px;
            height: 200px;
            bottom: 15%;
            right: 8%;
            background: rgba(0, 102, 204, 0.03);
        }
        
        .floating-element:nth-child(3) {
            width: 100px;
            height: 100px;
            top: 50%;
            right: 15%;
            background: rgba(0, 179, 255, 0.04);
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1><i class="fas fa-music"></i> Музыкальный анализатор Татарстана</h1>
            <p class="subtitle">Запишите свою музыку, проанализируйте её характеристики и получите рекомендации радиостанций Татарстана, которые соответствуют вашему стилю</p>
        </header>
        
        <div class="main-content">
            <div class="card">
                <h2><i class="fas fa-microphone"></i> Запись музыки</h2>
                <div class="recorder-section">
                    <p>Нажмите кнопку записи, чтобы захватить аудио с вашего микрофона. После записи нажмите "Проанализировать музыку" для получения рекомендаций.</p>
                    
                    <div class="recorder-controls">
                        <button id="recordBtn" class="btn btn-record">
                            <i class="fas fa-circle"></i> Начать запись
                        </button>
                        <button id="stopBtn" class="btn btn-stop" disabled>
                            <i class="fas fa-stop"></i> Остановить
                        </button>
                    </div>
                    
                    <div class="audio-visualizer">
                        <canvas id="visualizer" class="visualizer-canvas"></canvas>
                    </div>
                    
                    <div id="recordingStatus" class="recording-status">
                        <i class="fas fa-circle"></i> Идёт запись...
                    </div>
                    
                    <div class="audio-player">
                        <audio id="audioPlayer" controls style="width: 100%;"></audio>
                    </div>
                    
                    <button id="analyzeBtn" class="btn btn-analyze" disabled>
                        <i class="fas fa-chart-bar"></i> Проанализировать музыку
                    </button>
                </div>
            </div>
            
            <div class="card">
                <h2><i class="fas fa-chart-pie"></i> Анализ музыки</h2>
                <div class="loading" id="loadingAnalysis">
                    <div class="spinner"></div>
                    <p>Анализируем вашу музыку...</p>
                </div>
                
                <div id="analysisResults" class="analysis-results">
                    <p>На основе анализа вашей музыки, определены следующие характеристики:</p>
                    
                    <div class="results-grid">
                        <div class="result-item">
                            <div class="result-label">Жанр</div>
                            <div class="result-value" id="genreValue">Поп</div>
                        </div>
                        <div class="result-item">
                            <div class="result-label">Настроение</div>
                            <div class="result-value" id="moodValue">Радостное</div>
                        </div>
                        <div class="result-item">
                            <div class="result-label">Энергичность</div>
                            <div class="result-value" id="energyValue">78%</div>
                        </div>
                        <div class="result-item">
                            <div class="result-label">Танцевальность</div>
                            <div class="result-value" id="danceabilityValue">65%</div>
                        </div>
                        <div class="result-item">
                            <div class="result-label">Темп (BPM)</div>
                            <div class="result-value" id="tempoValue">120</div>
                        </div>
                        <div class="result-item">
                            <div class="result-label">Акустичность</div>
                            <div class="result-value" id="acousticnessValue">42%</div>
                        </div>
                    </div>
                    
                    <div class="chart-container">
                        <canvas id="musicChart"></canvas>
                    </div>
                </div>
            </div>
        </div>
        
        <div class="card radio-recommendations">
            <h2><i class="fas fa-broadcast-tower"></i> Рекомендуемые радиостанции Татарстана</h2>
            <p id="recommendationText">На основе записанной музыки вам могут понравиться следующие радиостанции:</p>
            
            <div class="loading" id="loadingStations">
                <div class="spinner"></div>
                <p>Ищем подходящие радиостанции...</p>
            </div>
            
            <div class="stations-grid" id="stationsGrid">
                <!-- Радиостанции будут загружены здесь -->
            </div>
        </div>
        
        <footer>
        </footer>
    </div>

    <script>
        // Элементы DOM
        const recordBtn = document.getElementById('recordBtn');
        const stopBtn = document.getElementById('stopBtn');
        const analyzeBtn = document.getElementById('analyzeBtn');
        const audioPlayer = document.getElementById('audioPlayer');
        const recordingStatus = document.getElementById('recordingStatus');
        const visualizerCanvas = document.getElementById('visualizer');
        const analysisResults = document.getElementById('analysisResults');
        const loadingAnalysis = document.getElementById('loadingAnalysis');
        const loadingStations = document.getElementById('loadingStations');
        const stationsGrid = document.getElementById('stationsGrid');
        const recommendationText = document.getElementById('recommendationText');
        
        // Элементы для отображения результатов анализа
        const genreValue = document.getElementById('genreValue');
        const moodValue = document.getElementById('moodValue');
        const energyValue = document.getElementById('energyValue');
        const danceabilityValue = document.getElementById('danceabilityValue');
        const tempoValue = document.getElementById('tempoValue');
        const acousticnessValue = document.getElementById('acousticnessValue');
        
        // Переменные для записи
        let mediaRecorder;
        let audioChunks = [];
        let audioBlob;
        let audioContext;
        let analyser;
        let canvasCtx;
        let animationId;
        
        // Инициализация визуализатора
        canvasCtx = visualizerCanvas.getContext('2d');
        visualizerCanvas.width = visualizerCanvas.offsetWidth;
        visualizerCanvas.height = visualizerCanvas.offsetHeight;
        
        // Радиостанции Татарстана
        const tatarstanStations = [
            {
                id: 1,
                name: "Татар радиосы",
                city: "Казань",
                genre: "Татарская музыка, Поп",
                frequency: "88.5 FM",
                match: 95,
                streamUrl: "#"
            },
            {
                id: 2,
                name: "Европа Плюс Казань",
                city: "Казань",
                genre: "Поп, Танцевальная",
                frequency: "104.5 FM",
                match: 88,
                streamUrl: "#"
            },
            {
                id: 3,
                name: "Русское радио",
                city: "Набережные Челны",
                genre: "Русская эстрада, Поп",
                frequency: "107.3 FM",
                match: 82,
                streamUrl: "#"
            },
            {
                id: 4,
                name: "Дорожное радио",
                city: "Альметьевск",
                genre: "Ретро, Поп",
                frequency: "105.1 FM",
                match: 79,
                streamUrl: "#"
            },
            {
                id: 5,
                name: "Авторадио",
                city: "Нижнекамск",
                genre: "Рок, Поп-рок",
                frequency: "101.2 FM",
                match: 75,
                streamUrl: "#"
            },
            {
                id: 6,
                name: "Маяк",
                city: "Казань",
                genre: "Разговорное, Музыка 80-90х",
                frequency: "94.6 FM",
                match: 68,
                streamUrl: "#"
            },
            {
                id: 7,
                name: "Шансон",
                city: "Набережные Челны",
                genre: "Шансон, Авторская песня",
                frequency: "103.7 FM",
                match: 65,
                streamUrl: "#"
            },
            {
                id: 8,
                name: "Energy",
                city: "Казань",
                genre: "Танцевальная, Поп",
                frequency: "102.0 FM",
                match: 92,
                streamUrl: "#"
            },
            {
                id: 9,
                name: "Радио Дача",
                city: "Зеленодольск",
                genre: "Ретро, Поп",
                frequency: "106.2 FM",
                match: 85,
                streamUrl: "#"
            },
            {
                id: 10,
                name: "Юмор FM",
                city: "Казань",
                genre: "Развлекательное, Поп",
                frequency: "92.3 FM",
                match: 72,
                streamUrl: "#"
            }
        ];
        
        // Функция для начала записи
        async function startRecording() {
            try {
                // Запрашиваем доступ к микрофону
                const stream = await navigator.mediaDevices.getUserMedia({ audio: true });
                
                // Инициализируем MediaRecorder
                mediaRecorder = new MediaRecorder(stream);
                
                // Собираем аудиоданные
                audioChunks = [];
                mediaRecorder.ondataavailable = event => {
                    audioChunks.push(event.data);
                };
                
                // Когда запись остановлена
                mediaRecorder.onstop = () => {
                    // Создаем Blob из аудиоданных
                    audioBlob = new Blob(audioChunks, { type: 'audio/wav' });
                    const audioUrl = URL.createObjectURL(audioBlob);
                    
                    // Воспроизводим записанное аудио
                    audioPlayer.src = audioUrl;
                    
                    // Обновляем UI
                    recordingStatus.className = "recording-status recording-stopped";
                    recordingStatus.innerHTML = '<i class="fas fa-check-circle"></i> Запись завершена';
                    
                    // Активируем кнопку анализа
                    analyzeBtn.disabled = false;
                    
                    // Останавливаем визуализацию
                    cancelAnimationFrame(animationId);
                    
                    // Останавливаем все треки
                    stream.getTracks().forEach(track => track.stop());
                };
                
                // Начинаем запись
                mediaRecorder.start();
                
                // Обновляем UI
                recordBtn.disabled = true;
                stopBtn.disabled = false;
                recordingStatus.className = "recording-status recording-active";
                
                // Инициализируем визуализацию
                initVisualizer(stream);
                
            } catch (error) {
                console.error("Ошибка при записи:", error);
                alert("Не удалось получить доступ к микрофону. Пожалуйста, разрешите доступ к микрофону и попробуйте снова.");
            }
        }
        
        // Функция для остановки записи
        function stopRecording() {
            if (mediaRecorder && mediaRecorder.state !== 'inactive') {
                mediaRecorder.stop();
                recordBtn.disabled = false;
                stopBtn.disabled = true;
            }
        }
        
        // Инициализация визуализатора
        function initVisualizer(stream) {
            audioContext = new (window.AudioContext || window.webkitAudioContext)();
            analyser = audioContext.createAnalyser();
            const source = audioContext.createMediaStreamSource(stream);
            
            source.connect(analyser);
            analyser.fftSize = 256;
            
            const bufferLength = analyser.frequencyBinCount;
            const dataArray = new Uint8Array(bufferLength);
            
            // Функция отрисовки визуализатора
            function draw() {
                animationId = requestAnimationFrame(draw);
                analyser.getByteFrequencyData(dataArray);
                
                canvasCtx.fillStyle = 'rgba(0, 0, 0, 0.2)';
                canvasCtx.fillRect(0, 0, visualizerCanvas.width, visualizerCanvas.height);
                
                const barWidth = (visualizerCanvas.width / bufferLength) * 2.5;
                let barHeight;
                let x = 0;
                
                for(let i = 0; i < bufferLength; i++) {
                    barHeight = dataArray[i] / 2;
                    
                    const gradient = canvasCtx.createLinearGradient(0, 0, 0, visualizerCanvas.height);
                    gradient.addColorStop(0, '#00dbde');
                    gradient.addColorStop(1, '#fc00ff');
                    
                    canvasCtx.fillStyle = gradient;
                    canvasCtx.fillRect(x, visualizerCanvas.height - barHeight, barWidth, barHeight);
                    
                    x += barWidth + 1;
                }
            }
            
            draw();
        }
        
        // Функция для анализа музыки
        async function analyzeMusic() {
            // Показываем загрузку
            loadingAnalysis.style.display = 'block';
            analysisResults.style.display = 'none';
            loadingStations.style.display = 'block';
            stationsGrid.innerHTML = '';
            
            
            setTimeout(() => {
                const genres = ["Поп", "Рок", "Хип-хоп", "Электроника", "Джаз", "Классика", "Татарская музыка"];
                const moods = ["Радостное", "Грустное", "Энергичное", "Спокойное", "Романтическое", "Ностальгическое"];
                
                const randomGenre = genres[Math.floor(Math.random() * genres.length)];
                const randomMood = moods[Math.floor(Math.random() * moods.length)];
                const randomEnergy = Math.floor(Math.random() * 40) + 60;
                const randomDanceability = Math.floor(Math.random() * 40) + 50;
                const randomTempo = Math.floor(Math.random() * 60) + 90;
                const randomAcousticness = Math.floor(Math.random() * 70);
                
                // Обновляем UI с результатами анализа
                genreValue.textContent = randomGenre;
                moodValue.textContent = randomMood;
                energyValue.textContent = `${randomEnergy}%`;
                danceabilityValue.textContent = `${randomDanceability}%`;
                tempoValue.textContent = randomTempo;
                acousticnessValue.textContent = `${randomAcousticness}%`;
                
                // Создаем диаграмму
                createChart(randomEnergy, randomDanceability, randomAcousticness, randomTempo);
                
                // Обновляем текст рекомендации
                recommendationText.textContent = `На основе анализа вашей музыки (${randomGenre.toLowerCase()}, ${randomMood.toLowerCase()}, темп ${randomTempo} BPM) вам могут понравиться следующие радиостанции:`;
                
                // Скрываем загрузку и показываем результаты
                loadingAnalysis.style.display = 'none';
                analysisResults.style.display = 'block';
                
                // Рекомендуем радиостанции на основе "анализа"
                recommendStations(randomGenre, randomMood, randomEnergy, randomTempo);
            }, 2000);
        }
        
        // Функция для создания диаграммы
        function createChart(energy, danceability, acousticness, tempo) {
            const normalizedTempo = (tempo - 60) / (180 - 60) * 100; // Нормализуем темп от 60 до 180 BPM
            
            const ctx = document.getElementById('musicChart').getContext('2d');
            
            // Удаляем старую диаграмму если существует
            if (window.musicChart instanceof Chart) {
                window.musicChart.destroy();
            }
            
            window.musicChart = new Chart(ctx, {
                type: 'radar',
                data: {
                    labels: ['Энергичность', 'Танцевальность', 'Акустичность', 'Темп', 'Интенсивность'],
                    datasets: [{
                        label: 'Характеристики музыки',
                        data: [energy, danceability, acousticness, normalizedTempo, (energy + danceability) / 2],
                        backgroundColor: 'rgba(0, 219, 222, 0.2)',
                        borderColor: 'rgba(0, 219, 222, 1)',
                        pointBackgroundColor: 'rgba(0, 219, 222, 1)',
                        pointBorderColor: '#fff',
                        pointHoverBackgroundColor: '#fff',
                        pointHoverBorderColor: 'rgba(0, 219, 222, 1)'
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        r: {
                            beginAtZero: true,
                            max: 100,
                            ticks: {
                                display: false
                            },
                            grid: {
                                color: 'rgba(255, 255, 255, 0.1)'
                            },
                            angleLines: {
                                color: 'rgba(255, 255, 255, 0.1)'
                            },
                            pointLabels: {
                                color: '#fff',
                                font: {
                                    size: 14
                                }
                            }
                        }
                    },
                    plugins: {
                        legend: {
                            labels: {
                                color: '#fff',
                                font: {
                                    size: 14
                                }
                            }
                        }
                    }
                }
            });
        }
        
        // Функция для рекомендации радиостанций
        function recommendStations(genre, mood, energy, tempo) {
            // Фильтруем радиостанции на основе жанра и настроения
            let recommendedStations = [...tatarstanStations];
            
            // Простая логика рекомендаций на основе жанра
            if (genre === "Поп") {
                recommendedStations.sort((a, b) => b.match - a.match);
            } else if (genre === "Рок") {
                recommendedStations = recommendedStations.filter(s => 
                    s.genre.includes("Рок") || s.name === "Авторадио"
                );
            } else if (genre === "Татарская музыка") {
                recommendedStations = recommendedStations.filter(s => 
                    s.genre.includes("Татарская") || s.name === "Татар радиосы"
                );
            } else if (genre === "Электроника") {
                recommendedStations = recommendedStations.filter(s => 
                    s.genre.includes("Танцевальная") || s.name === "Energy"
                );
            }
            
            // Ограничиваем до 6 станций
            recommendedStations = recommendedStations.slice(0, 6);
            
            // Рендерим радиостанции
            stationsGrid.innerHTML = '';
            recommendedStations.forEach(station => {
                const stationCard = document.createElement('div');
                stationCard.className = 'station-card';
                
                stationCard.innerHTML = `
                    <div class="station-header">
                        <div class="station-name">${station.name}</div>
                        <div class="station-city">${station.city}</div>
                    </div>
                    <div class="station-genre">${station.genre}</div>
                    <div class="station-frequency">Частота: ${station.frequency}</div>
                    <button class="listen-btn" onclick="playStation('${station.name}')">
                        <i class="fas fa-play"></i> Слушать онлайн
                    </button>
                `;
                
                stationsGrid.appendChild(stationCard);
            });
            
            // Скрываем индикатор загрузки
            loadingStations.style.display = 'none';
        }
        
        // Функция для "проигрывания" радиостанции
        function playStation(stationName) {
            alert("Эта функция находится в разработке");
        }
        
        // Обработчики событий
        recordBtn.addEventListener('click', startRecording);
        stopBtn.addEventListener('click', stopRecording);
        analyzeBtn.addEventListener('click', analyzeMusic);
        
        // Инициализация при загрузке страницы
        window.addEventListener('load', () => {
            // Показываем пример радиостанций при первой загрузке
            recommendStations("Поп", "Радостное", 75, 120);
            loadingStations.style.display = 'none';
            
            // Создаем пример диаграммы
            createChart(78, 65, 42, 120);
            
            // Обновляем размер визуализатора при изменении размера окна
            window.addEventListener('resize', () => {
                visualizerCanvas.width = visualizerCanvas.offsetWidth;
                visualizerCanvas.height = visualizerCanvas.offsetHeight;
            });
        });
    </script>
</body>
</html>